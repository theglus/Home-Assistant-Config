title: Winston
path: winston
icon: "mdi:robot-vacuum-variant"
panel: false
badges: []
cards:
  #################################################################
  ## Settings
  #################################################################
  - type: vertical-stack
    cards:
      - type: entities
        title: Settings
        card_mod:
          class: header
          style: |
            .card-header {
              font-family: SF Text;
              letter-spacing: 0.005em;
              font-size: 1.6em;
              font-weight: 500;
              line-height: initial;
              padding: 0.75em 0em 1em 1.1em;
              cursor: default;
              border-style: none;
            }
            ha-card {
              padding-right: 0.75em;
              border-style: none;
            }
        entities:
          - entity: vacuum.winston

          - entity: sensor.winston_last_clean_end
            name: Last Clean

          - type: custom:bar-card
            width: 55%
            height: 2em
            decimal: 0
            unit_of_measurement: "%"
            positions:
              icon: outside
              indicator: "off"
              name: outside
            severity:
              - color: "#303435"
                from: 11
                to: 100
              - color: "#6d2525"
                from: 0
                to: 10
            entity_row: true
            style: |
              ha-card {
                border-style: none;
              }
              bar-card-value { 
                font-size: 1em; 
                font-weight: 400; 
                color: #e0e1e1; 
                letter-spacing: 0.01em; 
                text-shadow: none; 
                margin-right: auto; 
                margin-left: auto;
                margin-top: 5px; 
              } 
              bar-card-name { 
                padding-left: 0.25em; 
              } 
              bar-card-iconbar { 
                padding-left: 0.23em;
              } 
              bar-card-backgroundbar { 
                background: none; 
              } 
              bar-card-currentbar {
                border-radius: 0.3em;
              }
              bar-card-background { 
                background: radial-gradient(circle, rgba(52, 57, 58, 0.1) 0%, rgba(17, 18, 18, 0.2) 75%); 
                box-shadow: inset 0 0 25px #00000045; 
                border-radius: 0.3em; 
                overflow: hidden; 
              }
            entities:
              - entity: vacuum.winston
                attribute: battery_level
                name: Battery
                icon: mdi:battery

              - entity: sensor.vacuum_filter
                name: Filter
                icon: custom:vacuum-filter

              - entity: sensor.vacuum_mainbrush
                name: Main Brush
                icon: custom:vacuum-mainbrush

              - entity: sensor.vacuum_sidebrush
                name: Side Brush
                icon: custom:vacuum-sidebrush

              - entity: sensor.vacuum_sensors
                name: Sensors
                icon: custom:vacuum-sensor

          - type: custom:mod-card
            card_mod:
              style:
                # horizontal bottom buttons
                hui-horizontal-stack-card$: |
                  #root {
                    justify-content: space-evenly !important;
                    padding: var(--tablet-popup-button-padding);
                  }
            card:
              type: horizontal-stack
              cards:
                - type: custom:button-card
                  entity: vacuum.winston
                  icon: mdi:play-pause
                  tap_action:
                    action: call-service
                    service: >
                      [[[
                        return entity.state === 'docked' || entity.state === 'paused'
                          ? 'vacuum.start'
                          : 'vacuum.pause';
                      ]]]
                    service_data:
                      entity_id: >
                        [[[ return entity.entity_id; ]]]
                  template: icon_only

                - type: custom:button-card
                  entity: vacuum.winston
                  icon: mdi:battery-charging
                  tap_action:
                    action: call-service
                    service: vacuum.return_to_base
                    service_data:
                      entity_id: >
                        [[[ return entity.entity_id; ]]]
                  template: icon_only

                - type: custom:button-card
                  icon: mdi:delete-empty
                  tap_action:
                    action: call-service
                    service: vacuum.send_command
                    service_data:
                      entity_id: vacuum.winston
                      command: app_goto_target
                      params: [30750, 22150]
                  template: icon_only

  #################################################################
  ## Vacuum Map
  #################################################################

  - type: vertical-stack
    cards:
      - type: entities
        title: Map
        color: transparent
        card_mod:
          style: |
            .card-header {
              font-family: SF Text;
              letter-spacing: 0.005em;
              font-size: 1.6em;
              font-weight: 500;
              padding: 0.75em 0em 1em 1.1em;
              line-height: initial;
              cursor: default;
            }
            #states {
              padding-bottom: 0;
              padding-top: 0;
            }
            ha-card {
              padding-right: 0.75em;
              border-style: none;
            }
          class: header
        entities:
          - type: custom:xiaomi-vacuum-map-card
            style: |
              ha-card {
                background: transparent;
                box-shadow: none;
                border-style: none;
              }
            entity: vacuum.winston
            map_source:
              camera: camera.xiaomi_cloud_map_extractor
            calibration_source:
              camera: true
            map_locked: true
            tiles: []
            icons: []
            map_modes:
              - template: vacuum_clean_segment
                predefined_selections:
                  - id: 18
                    icon:
                      name: mdi:washing-machine
                      x: 29150
                      y: 21975
                  - id: 19
                    icon:
                      name: mdi:chair-school
                      x: 25275
                      y: 22325
                  - id: 20
                    icon:
                      name: mdi:fridge
                      x: 22200
                      y: 22700
                  - id: 17
                    icon:
                      name: mdi:sofa
                      x: 29275
                      y: 24650
                  - id: 16
                    icon:
                      name: mdi:coat-rack
                      x: 23775
                      y: 24950
          - type: custom:more-info-card
            entity: vacuum.winston
            card_mod:
              style:
                # hide everything but ha-select
                $: |
                  h1 {
                    display: none !important;
                  }
                .: |
                  h1, state-card-content {
                    display: none !important;
                  }
                  .card-content {
                    padding: 1.5em 0 0 0.7em;
                  }
                more-info-vacuum$:
                  .: |
                    div.flex-horizontal>div, div:nth-child(2), ha-attributes {
                      display: none;
                    }
                    ha-select {
                      display: contents;
                    }
                  ha-select:
                    $:
                      # no icon so remove label inset
                      .: |
                        .mdc-floating-label {
                          inset-inline-start: 0 !important;
                        }
                      # fix transparent menu background color
                      mwc-menu$: |
                        mwc-list {
                          background: var(--card-background-color);
                        }
          # ha-card:
          #   background: transparent;
          #   box-shadow: none;
          #   border-style: none;
          # }
